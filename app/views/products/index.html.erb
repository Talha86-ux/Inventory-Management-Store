<% if current_user.role == "Manager" %>

<%=form_tag company_products_path, method: :get do  %>
  <%=text_field_tag :search, params[:search], placeholder: 'Search products ...' %>
  <%=submit_tag("Search", title: nil, class: "btn btn-primary") %>
  <%= link_to 'Reset', company_products_path, class: "btn btn-info"%>
<%end%>
  <h1 class="heading">Products</h1>
  <table class="table table-striped table-hover space">
    <thead class="thead-light">
    <th>Title</th>
    <th>Description</th>
    <th>Stock</th>
    <th>Supplier</th>
    <th>Action</th>
    </thead>
    <tbody>
    <%if @products.length > 0 %>
      <%@products.each do |p| %>
        <tr>
          <td><%=p.title %></td>
          <td><%=p.description %></td>
          <td><%=p.quantity %></td>
          <%supplier= Supplier.find_by(id: p.supplied_by) %>
          <td><%=supplier.name%></td>
          <%c = Company.where(assign_manager: current_user.id).first %>
          <td><%= link_to 'Edit', "/companies/#{c.id}/products/#{p.id}/edit" %> &nbsp; &nbsp;
          <%= link_to 'delete',
                          { controller: "products", action: "destroy", id: p.id },
                          data: { confirm: 'Are you sure?' },
                          method: :delete, class:"icon_color" %>
          </td>
      <%end %>
    <%else%>
      <p>Nothing Found</p>
    <%end%>
    </tr>
    </tbody>
  </table>
  <%= link_to 'New Product', new_company_product_path, class: "btn btn-secondary"%>

<%end %>